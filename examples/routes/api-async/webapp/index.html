<html>
  <title>Example Async</title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
</html>

<body>

  <div class="container">

    <h1>Message</h1>

    <form>
      <input type="text"></input>
      <button></button>
    </form>

    <hr/>

    <h1> Async response from server </h1>


    <script>

      const HTTP_DOMAIN = 'your api HTTP domain '
      const REALTIME_DOMAIN = 'api real-time domain'
      const API_KEY = 'your api key'

      const authorization = { 'x-api-key': API_KEY, host: HTTP_DOMAIN }

      // construct the protocol header for the connection
      function getAuthProtocol() {
	const header = btoa(JSON.stringify(authorization))
	      .replace(/\+/g, '-') // Convert '+' to '-'
	      .replace(/\//g, '_') // Convert '/' to '_'
	      .replace(/=+$/, '') // Remove padding `=`
	return `header-${header}`
      }

      const socket = await new Promise((resolve, reject) => {
	const socket = new WebSocket(`wss://${REALTIME_DOMAIN}/event/realtime`, [
	  'aws-appsync-event-ws',
	  getAuthProtocol(),
	])
	socket.onopen = () => resolve(socket)
	socket.onclose = (event) => reject(new Error(event.reason))
	socket.onmessage = (event) => console.log(event)
      })

      // when the socket is connected, send the message
      socket.send(JSON.stringify(message))
    </script>

  </div>


</body>
