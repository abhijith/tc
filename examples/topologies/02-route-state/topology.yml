name: 02-route-state

events:
  consumes:
    FooAPIEvent:
      producer: apiHandler

routes:
  api:
    gateway: api-test
    method: POST
    path: "/api/foo"

flow:
  Comment: default topology
  StartAt: foo
  TimeoutSeconds: 600
  States:
    foo:
      Type: Task
      Resource: arn:aws:states:::lambda:invoke
      OutputPath: $.Payload
      Parameters:
        FunctionName: '{{namespace}}_foo_{{sandbox}}'
        Payload:
            data.$: $
      Next: bar

    bar:
      Type: Task
      Resource: arn:aws:states:::lambda:invoke
      OutputPath: $.Payload
      Parameters:
        FunctionName: '{{namespace}}_bar_{{sandbox}}'
        Payload:
            data.$: $
      End: True
