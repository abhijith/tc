name: example-tests
mode: Express

events:
  MyEvent:
    function: foo

routes:
  ping:
    path: /api/ping
    method: GET
    function: pinger

flow:
  StartAt: processor
  TimeoutSeconds: 300
  States:
    processor:
      Type: Task
      Resource: arn:aws:states:::lambda:invoke
      OutputPath: $.Payload
      Parameters:
        FunctionName: '{{namespace}}_processor_{{sandbox}}'
        Payload:
          data.$: $.start
      End: true

tests:
  function-test:
    entity: functions/foo
    payload: '{"foo": "bar"}'
    condition: matches
    expect: '{"foo": "bar"}'
  state-test:
    entity: state
    payload: '{"start": "process"}'
    condition: matches
    expect: '{"status": "ok"}'
  route-test:
    entity: routes/ping
    payload: '{"start": "process"}'
    condition: includes
    expect: '{"status": "ok"}'
