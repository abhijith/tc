<html>

  <body>

    <script>

      const HTTP_DOMAIN = ''
      const REALTIME_DOMAIN = ''
      const API_KEY = ''

      const authorization = { 'x-api-key': API_KEY, host: HTTP_DOMAIN }

      // construct the protocol header for the connection
      function getAuthProtocol() {
	const header = btoa(JSON.stringify(authorization))
	      .replace(/\+/g, '-') // Convert '+' to '-'
	      .replace(/\//g, '_') // Convert '/' to '_'
	      .replace(/=+$/, '') // Remove padding `=`
	return `header-${header}`
      }

      async function init() {

	const message = {
	  id: '1234', // Your unique id for this message.
	  type: 'publish',
	  channel: '/test-channel',
	  events: [
	    JSON.stringify({ message: "hello world" }),
	    JSON.stringify({ number: 42 })
	  ],
	  authorization: { 'x-api-key': API_KEY },
	}


	const socket = await new Promise((resolve, reject) => {
	  const socket = new WebSocket(`wss://${REALTIME_DOMAIN}/event/realtime`, [
	    'aws-appsync-event-ws',
	    getAuthProtocol(),
	  ])
	  socket.onopen = () => resolve(socket)
	  socket.onclose = (event) => reject(new Error(event.reason))
	  socket.onmessage = (event) => console.log(event)
	})
	socket.send(JSON.stringify(message))
      }


      init().then(
	console.log('sent')
      )
      // when the socket is connected, send the message

    </script>

  </body>

</html>
